<!-- HERE IS WERE THE HEAD START  -->
<header class="header-back" [style]="hasDashboard ? 'height: 70px' : 'height: 200px'">
    <app-nav-bar></app-nav-bar>
  </header>
    <!-- HERE IS FOR SEARCH INPUT FORM -->
    <div class="flex justify-center items-center mt-[-4%]">
        <div class="border-2 bg-white h-32 flex items-center justify-center" style="width: 60%;">
              <!-- <form class="flex items-center" style="width: 90%;">    -->
                <section class="flex items-center" style="width: 90%;">   
                  <div class="relative w-full flex items-center" >
                      <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                          <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 21 21">
                              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.15 5.6h.01m3.337 1.913h.01m-6.979 0h.01M5.541 11h.01M15 15h2.706a1.957 1.957 0 0 0 1.883-1.325A9 9 0 1 0 2.043 11.89 9.1 9.1 0 0 0 7.2 19.1a8.62 8.62 0 0 0 3.769.9A2.013 2.013 0 0 0 13 18v-.857A2.034 2.034 0 0 1 15 15Z"/>
                          </svg>
                      </div>
                      <input type="text" [(ngModel)]="searchBackendText" (keyup)="loadModels()" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-white dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500 hover:border-green-600" placeholder="Search Models"/>

                  </div>
                </section>
            <!-- </form> -->
        </div>
    </div>
    <!-- HERE IS THE MAIN BODY -->
    <main class="mt-10 px-5">
        <div class="flex flex-row border h-[100vh]  border-zinc-100 models">
            <div *ngIf="!hasDashboard" class=" basis-1/4 col-auto px-5 shadow-sm border border-gray-100 filters" style="background-color: #fafcfd;">
                <div class="border-b flex flex-wrap py-3">
                  <mat-icon svgIcon="filters" class="text-gray-300" style="color: rgb(175, 175, 175);" aria-hidden="false" aria-label="filters"></mat-icon>
                  <span class="text-gray-500 tracking-wider mt-1 mx-1 font-semibold">Filters</span>
                </div>
                  <div class="border-t border-gray-200 px-4 py-6">
                    <h3 class="-mx-2 mt-4 flow-root">
                        <span class="font-medium text-gray-900">Select Category</span>
                    </h3>
                     <div class="pt-6" id="filter-section-mobile-0">
                      <div class="space-y-6">
                        <div *ngFor="let category of categories" class="flex items-center">
                          <input [checked]="checkedCategories.includes(category.name)"
                          (change)="onCategoryChange(category.name, $event)" id="filter-mobile-color-1" name="color[]" value="beige" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                          <label for="filter-mobile-color-1" class="ml-3 min-w-0 flex-1 text-gray-500">{{category.name}}</label>
                        </div>
                      </div>
                    </div>
                    
                    <h3 class="-mx-2 mt-4 flow-root">
                      <span class="font-medium text-gray-900">Sort Criteria</span>
                  </h3>
                  <div class="pt-6" id="filter-section-mobile-1">
                    <div class="space-y-6">
                      <div class="flex items-center" *ngFor="let column of sortColumns; let i = index">
                        <input (change)="sortModels()" [(ngModel)]="selectedSortColumn" [id]="'filter-mobile-category-' + i" name="sort-column" [value]="column" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <label [for]="'filter-mobile-category-' + i" class="ml-3 min-w-0 flex-1 text-gray-500">{{ column }}</label>
                      </div>
                    </div>
                  </div>                
                  </div>
            </div>
            <div [class]="hasDashboard ? 'basis-12/12' : 'basis-9/12'">
                <div class="grid grid-rows-1 lg:grid-cols-3 items-center sm:grid-cols-1 md:grid-cols-2 mt-8">
                    <div class="flex items-center ml-5 mb-3 ">
                        <span class="text-sm font-medium text-zinc-500 tracking-wider">Models</span>
                        <span class="text-sm text-zinc-400 font-medium ml-2">{{modelNo}}</span>
                    </div>

                  </div>
          
                    <button *ngIf="!hasDashboard" class="large-filter" (click)="toggleContent()">filters</button>
                    <button *ngIf="hasDashboard" (click)="toggleContent()">filters</button>
                    <div [class]="hasDashboard ? '' : 'large-filter'" id="contentToToggle" *ngIf="showContent" class="">
                        <div class="w-[80%] px-5 shadow-md" style="background-color: #f9fcff; position: absolute; z-index: 9">
                            <div class="border-b py-3">
                                <h2 class="text-gray-500">Models Filters</h2>
                            </div>
                              <div class="border-t border-gray-200 px-4 py-6">
  
                                <h3 class="-mx-2 mt-4 flow-root">
                                  <span class="font-medium text-gray-900">Select Category</span>
                              </h3>
                                <div class="pt-6" id="filter-section-mobile-0">
                                <div class="space-y-6">
                                  <div *ngFor="let category of categories" class="flex items-center">
                                    <input [checked]="checkedCategories.includes(category.name)"
                                    (change)="onCategoryChange(category.name, $event)" id="filter-mobile-color-1" name="color[]" value="beige" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <label for="filter-mobile-color-1" class="ml-3 min-w-0 flex-1 text-gray-500">{{category.name}}</label>
                                  </div>
                                </div>
                              </div>
                                <h3 class="-mx-2 mt-4 flow-root">
                                    <span class="font-medium text-gray-900">Sort Criteria</span>
                                </h3>
                                <div class="pt-6" id="filter-section-mobile-1">
                                  <div class="space-y-6">
                                    <div class="flex items-center" *ngFor="let column of sortColumns; let i = index">
                                      <input (change)="sortModels()" [(ngModel)]="selectedSortColumn" [id]="'filter-mobile-category-' + i" name="sort-column" [value]="column" type="radio" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                      <label [for]="'filter-mobile-category-' + i" class="ml-3 min-w-0 flex-1 text-gray-500">{{ column }}</label>
                                    </div>
                                  </div>
                                </div>     
                              </div>
                        </div>
                    </div>
                    <div *ngIf="isDownloading" class="fixed top-0 left-0 w-full h-full flex items-center justify-center z-50">
                      <app-loading></app-loading>
                    </div>
                    
                <div class="grid mt-0 grid-cols-1 md:grid-cols-1 xl:grid-cols-1 sm:grid-cols-1">
                  <div [class]="hasDashboard ? 'grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 p-5' : 'grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 p-5'" class="mt-4 w-full">
                    <div *ngFor="let model of models" class="bg-white zoom-in hover:zoom-in overflow-hidden text-ellipsis border border-zinc-200 shadow-sm rounded-lg px-3 py-2 hover:cursor-pointer ">
                      <div class="flex items-center">
                          <div class="flex-shrink-0">
                            <div class="w-full">
                              <a [routerLink]="hasDashboard ? '/dashboard/model-view/' + model.id : '/model-view/' + model.id" class="block w-full">
                                <span class="justify-between text-sm sm:text-sm leading-none font-medium tracking-widest" style="font-size: 0.7rem;">Title : </span>
                                <span class="text-gray-400 text-ellipsis" style="font-size: 0.7rem;">{{ model?.title }} </span><br>
                                <span class="text-sm sm:text-sm leading-none font-medium tracking-widest" style="font-size: 0.7rem;">By : </span>
                                <span class="text-gray-400" style="font-size: 0.7rem;">{{ model.repository.owner.username }}</span><br>
                              </a>
                            </div>
                            
                              <ul class="flex gap-2">
                                <li class="flex flex-wrap justify-center items-center " (click)="downloadModel(model)">
                                  <mat-icon svgIcon="download" class="text-gray-300" style="color: rgb(175, 175, 175);" aria-hidden="false" aria-label="download"></mat-icon>
                                  <span class="font-normal text-sm text-gray-400 mt-1" style="font-size: 0.8rem;">{{model.downloads}}</span>
                                </li>
                                <li class="flex flex-wrap justify-center items-center" [routerLink]="hasDashboard ? '/dashboard/model-view/' + model.id : '/model-view/' + model.id">
                                  <mat-icon svgIcon="view" width="10%" class="text-gray-300" style="color: rgb(175, 175, 175);" aria-hidden="false" aria-label="views"></mat-icon>
                                  <span class="font-normal text-sm text-gray-400" style="font-size: 0.8rem;">{{model.viewers}}</span>
                                </li>
  
                              </ul>
                          </div>
                      </div>
                      
                  </div>
          </div>              
        </div>            
        <div class="fixed bottom-0 left-0 w-full">
          <div class="flex mx-5 justify-center mb-3">
            <app-pagination [currentPage]="currentPage" [totalPages]="totalPages" (pageChange)="onPageChange($event)"></app-pagination>
          </div>
        </div>
        
            </div>
        </div>
    
    </main>
    <div *ngIf="isUserModalOpen" class="modal-overlay fixed inset-0 bg-black opacity-50 z-50"></div>
    <div *ngIf="isUserModalOpen" class="modal-container fixed inset-0 flex items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-lg p-8 w-full md:w-1/3">
            <h2 class="text-xl font-semibold mb-4">Login first to download models</h2>
                <!-- Unauthorized Page -->
              <div class="flex items-center justify-center bg-gray-100">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">Unauthorized Access</h1>
                    <p class="text-lg text-gray-600 mb-6">Sorry, you do not have permission to Download model without login.</p>
                </div>
              </div>
                <div class="flex justify-end mt-4">
                    <button mat-button color="primary" (click)="closeModal()">Continue without login</button>
                    <button routerLink="/login" type="submit" mat-button color="primary">Login Now</button>
                </div>
        </div>
    </div>